<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/login.css">
  <link rel="stylesheet" href="css/global.css">
  <title>Login Ouvidores - Ouve Mat√£o</title>
</head>

<body class="login-page">
  <div class="container">
    <!-- Esquerda -->
    <div class="left-side">
      <img src="img/logo-header.png" alt="Ouve Mat√£o" class="logo">
      <div class="links">
        <a href="termos.html">TERMOS E POL√çTICAS</a>
        <a href="sobre.html">SOBRE N√ìS</a>
      </div>
    </div>

    <!-- Direita -->
    <div class="right-side">
      <form id="login-ouvidores-form" class="login-form">
        <div class="form-heading">
          <h3>Ol√°, ouvidor!</h3>
          <h6>Por favor, fa√ßa login para continuar.</h6>
        </div>
        <div class="input-group">
          <input required placeholder="Digite o CPF cadastrado" name="cpf" id="cpf-ouvidor" type="text" />
          <label class="label" for="cpf-ouvidor">Usu√°rio</label>
        </div>
        <div class="input-group">
          <input required placeholder="Digite sua senha definida" name="password" id="password-ouvidor"
            type="password" />
          <label class="label" for="password-ouvidor">Senha</label>

        </div>
        <button class="submit" type="submit">Acessar</button>
      </form>
    </div>
  </div>

  <!-- CONTATO -->
  <section id="contato">
    <div class="info">
      <h1>Contato</h1>
      <p>Rua Alegre, 123, Cidade Brasileira</p>
      <p>Tel: (12) 3456-7890</p>
      <p>ola@grandesite.com.br</p>
    </div>
    <div class="social">
      <div class="social-content">
        <h2>Siga a gente<br />nas redes sociais</h2>
        <div class="redes">
          <a href="#"><img src="img/facebook.svg" alt="Facebook" /></a>
          <a href="#"><img src="img/instagram.svg" alt="Instagram" /></a>
          <a href="ouvidores.html"><img src="img/youtube.svg" alt="YouTube" /></a>
        </div>
        <img src="img/logo-header.png" alt="Ouve Mat√£o" class="logo-ouvidoria" />
      </div>
    </div>
  </section>

  <!-- Script de login com m√°scara de CPF -->
  <script type="module">
    import { supabase } from './supabase.js';

    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('login-ouvidores-form');
      const cpfInput = document.getElementById('cpf-ouvidor');

      if (!form) {
        console.error("Formul√°rio de ouvidores n√£o encontrado!");
        return;
      }

      // üîπ M√°scara de CPF
      cpfInput.addEventListener('input', function () {
        let value = cpfInput.value.replace(/\D/g, ''); // remove tudo que n√£o √© n√∫mero
        if (value.length > 11) value = value.slice(0, 11);

        if (value.length > 9) {
          value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{1,2})/, '$1.$2.$3-$4');
        } else if (value.length > 6) {
          value = value.replace(/(\d{3})(\d{3})(\d{0,3})/, '$1.$2.$3');
        } else if (value.length > 3) {
          value = value.replace(/(\d{3})(\d{0,3})/, '$1.$2');
        }
        cpfInput.value = value;
      });
      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const cpf = cpfInput.value.trim();
        const senha = document.getElementById('password-ouvidor').value.trim();

        try {
          const { data, error } = await supabase
            .from('usuarios')
            .select('*')
            .eq('cpf', cpf)
            .eq('senha', senha)
            .eq('tipo_usuario', 'ouvidor')
            .single();

          if (error || !data) {
            alert("‚ùå CPF ou senha inv√°lidos para ouvidor!");
            return;
          }

          // üîπ Salva apenas durante a sess√£o
          sessionStorage.setItem('usuario_ouvidor', JSON.stringify(data));

          alert("‚úÖ Login realizado com sucesso!");
          window.location.href = "ouvidores.html";

        } catch (err) {
          console.error("Erro inesperado:", err);
          alert("‚ùå Ocorreu um erro no login!");
        }
      });
    });



    (function () {
      const input = document.getElementById('password-ouvidor');
      if (!input) return;

      function addEyeIcon(input) {
        const wrapper = input.parentElement;
        wrapper.style.position = 'relative';
        const eye = document.createElement('img');
        eye.src = 'img/olho-fechado.png';
        eye.alt = 'Mostrar senha';
        eye.style.position = 'absolute';
        eye.style.right = '10px';
        eye.style.top = '50%';
        eye.style.transform = 'translateY(-50%)';
        eye.style.cursor = 'pointer';
        eye.style.width = '24px';
        eye.style.height = '24px';
        eye.addEventListener('click', () => {
          input.type = input.type === 'password' ? 'text' : 'password';
          eye.src = input.type === 'password' ? 'img/olho-fechado.png' : 'img/olho-aberto.png';
        });
        wrapper.appendChild(eye);
      }

      addEyeIcon(input);
    })();
  </script>
</body>

</html>