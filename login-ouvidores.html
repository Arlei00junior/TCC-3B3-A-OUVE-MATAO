<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/login.css">
  <link rel="stylesheet" href="css/global.css">
  <link rel="stylesheet" href="css/toast.css">
  <title>Login Ouvidores - Ouve Mat칚o</title>
</head>

<body class="login-page">
  <div class="container">
    <!-- Esquerda -->
    <div class="left-side">
      <img src="img/logo-header.png" alt="Ouve Mat칚o" class="logo">
      <div class="links">
        <a href="termos.html">TERMOS E POL칈TICAS</a>
        <a href="sobre.html">SOBRE N칍S</a>
      </div>
    </div>
    <!-- Bot칚o flutuante de acessibilidade -->
    <button id="btnAcessibilidade" title="Ativar leitura de tela">
      游댉
    </button>

    <script src="acessibilidade.js"></script>

    <!-- Direita -->
    <div class="right-side">
      <form id="login-ouvidores-form" class="login-form">
        <div class="form-heading">
          <h3>Ol치, ouvidor!</h3>
          <h6>Por favor, fa칞a login para continuar.</h6>
        </div>
        <div class="input-group">
          <input required placeholder="Digite o CPF cadastrado" name="cpf" id="cpf-ouvidor" type="text" />
          <label class="label" for="cpf-ouvidor">Usu치rio</label>
        </div>
        <div class="input-group">
          <input required placeholder="Digite sua senha definida" name="password" id="password-ouvidor"
            type="password" />
          <label class="label" for="password-ouvidor">Senha</label>

        </div>
        <button class="submit" type="submit">Acessar</button>
      </form>
    </div>
  </div>

  <!-- CONTATO -->
  <section id="contato">
    <div class="info">
      <h1>Contato</h1>
      <p>Rua Alegre, 123, Cidade Brasileira</p>
      <p>Tel: (12) 3456-7890</p>
      <p>ola@grandesite.com.br</p>
    </div>
    <div class="social">
      <div class="social-content">
        <h2>Siga a gente<br />nas redes sociais</h2>
        <div class="redes">
          <a href="#"><img src="img/facebook.svg" alt="Facebook" /></a>
          <a href="#"><img src="img/instagram.svg" alt="Instagram" /></a>
          <a href="ouvidores.html"><img src="img/youtube.svg" alt="YouTube" /></a>
        </div>
        <img src="img/logo-header.png" alt="Ouve Mat칚o" class="logo-ouvidoria" />
      </div>
    </div>
  </section>
  <!-- Toast container -->
  <div id="toasts-container"></div>

  <!-- Toast script -->
  <script src="script/toast.js"></script>

  <!-- Script de login com m치scara de CPF -->
  <script type="module">
    import { supabase } from './supabase.js';
    /*
      Script de login para ouvidores (login-ouvidores.html)
      - M치scara de CPF (formata칞칚o enquanto digita)
      - Submiss칚o do formul치rio: consulta Supabase por tipo_usuario='ouvidor'
      - Salva 'usuario_ouvidor' na sessionStorage em caso de sucesso
      - Fun칞칚o utilit치ria para mostrar/ocultar senha (칤cone de olho)
    */

    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('login-ouvidores-form');
      const cpfInput = document.getElementById('cpf-ouvidor');

      if (!form) {
        console.error("Formul치rio de ouvidores n칚o encontrado!");
        return;
      }

      // M치scara de CPF (apenas UX)
      cpfInput.addEventListener('input', function () {
        let value = cpfInput.value.replace(/\D/g, ''); // remove tudo que n칚o 칠 n칰mero
        if (value.length > 11) value = value.slice(0, 11);

        if (value.length > 9) {
          value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{1,2})/, '$1.$2.$3-$4');
        } else if (value.length > 6) {
          value = value.replace(/(\d{3})(\d{3})(\d{0,3})/, '$1.$2.$3');
        } else if (value.length > 3) {
          value = value.replace(/(\d{3})(\d{0,3})/, '$1.$2');
        }
        cpfInput.value = value;
      });

      // Evento de submit: autentica ouvidor
      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const cpf = cpfInput.value.trim();
        const senha = document.getElementById('password-ouvidor').value.trim();

        try {
          const { data, error } = await supabase
            .from('usuarios')
            .select('*')
            .eq('cpf', cpf)
            .eq('senha', senha)
            .eq('tipo_usuario', 'ouvidor')
            .single();

          if (error || !data) {
            showToast('CPF ou senha inv치lidos para ouvidor!', 'error');
            return;
          }

          // Salva apenas durante a sess칚o
          sessionStorage.setItem('usuario_ouvidor', JSON.stringify(data));

          showToast('Login realizado com sucesso!');
          setTimeout(() => window.location.href = 'ouvidores.html', 800);

        } catch (err) {
          console.error("Erro inesperado:", err);
          showToast('Ocorreu um erro no login!', 'error');
        }
      });
    });

    // Adiciona 칤cone de olho ao campo de senha do ouvidor (UX)
    (function () {
      const input = document.getElementById('password-ouvidor');
      if (!input) return;

      function addEyeIcon(input) {
        const wrapper = input.parentElement;
        wrapper.style.position = 'relative';
        const eye = document.createElement('img');
        eye.src = 'img/olho-fechado.png';
        eye.alt = 'Mostrar senha';
        eye.style.position = 'absolute';
        eye.style.right = '10px';
        eye.style.top = '50%';
        eye.style.transform = 'translateY(-50%)';
        eye.style.cursor = 'pointer';
        eye.style.width = '24px';
        eye.style.height = '24px';
        eye.addEventListener('click', () => {
          input.type = input.type === 'password' ? 'text' : 'password';
          eye.src = input.type === 'password' ? 'img/olho-fechado.png' : 'img/olho-aberto.png';
        });
        wrapper.appendChild(eye);
      }

      addEyeIcon(input);
    })();
  </script>
</body>

</html>